# 設計原則・変更禁止ルール

## 🔒 **変更禁止（STABLE）- 最適化済みコンポーネント**

以下のコンポーネント/設定は**既に最適化されており、変更禁止**です。
問題が発生しても、これらの設計判断を尊重してください。

### **1. キャッシュ戦略**

#### **TiDB Data APIフェッチ**
- **ファイル**: `components/LegalPage.tsx`
- **設定**: `next: { revalidate: 3600 }`
- **理由**: 
  - 法的ページはほとんど更新されない
  - 初回のみTiDBからフェッチ、その後1時間キャッシュ
  - Core Web Vitals最適化（Google SEO上位表示）
- **変更禁止理由**: パフォーマンスとコストの最適バランス

#### **ページレベルのキャッシュ**
- **設定**: `export const dynamic`や`export const revalidate`は**追加しない**
- **理由**: コンポーネント内のfetchレベルでキャッシュ制御する方が柔軟
- **例外**: 特定の理由がある場合のみ、事前に確認

---

## 🚧 **開発中（WIP）- 変更可能**

以下は開発中のため、改善・変更可能です。

### **1. ルーティング戦略**
- **ファイル**: `app/[...slug]/page.tsx`, `middleware.ts`
- **状態**: catchallルートと専用ルートの優先順位問題を解決中
- **方針**: Next.jsのベストプラクティスに従う

### **2. 法的ページのUI/UX**
- **ファイル**: `components/LegalPage.tsx`（UIスタイリング部分のみ）
- **状態**: 基本実装完了、デザイン改善可能

### **3. aboutページ**
- **ファイル**: `app/about/page.tsx`
- **状態**: コンテンツ確定、TiDB移行は今後検討

---

## 📖 **重要な設計判断の記録**

### **1. TiDB統合戦略**
- **日付**: 2026-02-07
- **判断**: 法的ページをTiDB + Data APIで動的取得
- **理由**: 
  - コンテンツ管理の一元化
  - 更新作業の簡素化（SQLだけで完結）
  - Next.jsとDBの分離

### **2. Cloudflare Images採用**
- **日付**: 過去のセッション
- **判断**: 画像ホスティングにCloudflare R2 + Images
- **理由**: 
  - Vercelの画像最適化コスト削減
  - Page Speed向上
  - Core Web Vitals改善

### **3. 4層構造（BIG/MID/LOW/DETAIL）**
- **日付**: 過去のセッション
- **判断**: SEO最適化のための階層的ページ構造
- **理由**: トピッククラスター戦略、検索意図への最適化

---

## ⚠️ **変更前の確認ルール**

既存のコードを変更する前に、以下を確認してください：

1. **この設計判断は既にドキュメント化されているか？**
   → このファイルとREADME.mdを確認

2. **パフォーマンス最適化が施されているか？**
   → `revalidate`, `cache`, `dynamic`などの設定をチェック

3. **変更の影響範囲を理解しているか？**
   → SEO、コスト、UXへの影響を考慮

4. **不確実な場合は必ずユーザーに確認**
   → 「この設定を変更しても良いですか？」と聞く

---

## 🎯 **今後のルール運用**

- このファイルは**プロジェクトの憲法**として扱う
- 新しい設計判断があれば、このファイルに追記
- AIエージェントは作業開始前にこのファイルを参照
- 不明点があれば、変更せずにユーザーに確認

---

**最終更新**: 2026-02-07
**作成者**: rk + AI Assistant
